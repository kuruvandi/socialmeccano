var ajaxChat={settingsInitiated:null,styleInitiated:null,initializeFunction:null,finalizeFunction:null,loginChannelID:null,loginChannelName:null,timerRate:null,timer:null,ajaxURL:null,baseURL:null,regExpMediaUrl:null,dirs:null,startChatOnLoad:null,chatStarted:null,domIDs:null,dom:null,settings:null,nonPersistentSettings:null,unusedSettings:null,bbCodeTags:null,colorCodes:null,emoticonCodes:null,emoticonFiles:null,soundFiles:null,sounds:null,soundTransform:null,sessionName:null,cookieExpiration:null,cookiePath:null,cookieDomain:null,cookieSecure:null,chatBotName:null,chatBotID:null,allowUserMessageDelete:null,inactiveTimeout:null,privateChannelDiff:null,privateMessageDiff:null,showChannelMessages:null,messageTextMaxLength:null,socketServerEnabled:null,socketServerHost:null,socketServerPort:null,socketServerChatID:null,socket:null,socketIsConnected:null,socketTimerRate:null,socketReconnectTimer:null,socketRegistrationID:null,userID:null,userName:null,userRole:null,channelID:null,channelName:null,channelSwitch:null,usersList:null,userNamesList:null,userMenuCounter:null,encodedUserName:null,userNodeString:null,ignoredUserNames:null,lastID:null,localID:null,lang:null,langCode:null,baseDirection:null,originalDocumentTitle:null,blinkInterval:null,httpRequest:null,retryTimer:null,retryTimerDelay:null,requestStatus:"ok",DOMbuffering:null,DOMbuffer:null,DOMbufferRowClass:"rowOdd",init:function(e,t,s,i,n,a,r){this.httpRequest={},this.usersList=[],this.userNamesList=[],this.userMenuCounter=0,this.lastID=0,this.localID=0,this.lang=t,this.initConfig(e),this.initDirectories(),s&&this.initSettings(),i&&this.initStyle(),this.initializeFunction=a,this.finalizeFunction=r,n&&this.setLoadHandler()},initConfig:function(e){this.loginChannelID=e.loginChannelID,this.loginChannelName=e.loginChannelName,this.timerRate=e.timerRate,this.ajaxURL=e.ajaxURL,this.baseURL=e.baseURL,this.regExpMediaUrl=e.regExpMediaUrl,this.startChatOnLoad=e.startChatOnLoad,this.domIDs=e.domIDs,this.settings=e.settings,this.nonPersistentSettings=e.nonPersistentSettings,this.bbCodeTags=e.bbCodeTags,this.colorCodes=e.colorCodes,this.emoticonCodes=e.emoticonCodes,this.emoticonFiles=e.emoticonFiles,this.soundFiles=e.soundFiles,this.sessionName=e.sessionName,this.cookieExpiration=e.cookieExpiration,this.cookiePath=e.cookiePath,this.cookieDomain=e.cookieDomain,this.cookieSecure=e.cookieSecure,this.chatBotName=e.chatBotName,this.chatBotID=e.chatBotID,this.allowUserMessageDelete=e.allowUserMessageDelete,this.inactiveTimeout=e.inactiveTimeout,this.privateChannelDiff=e.privateChannelDiff,this.privateMessageDiff=e.privateMessageDiff,this.showChannelMessages=e.showChannelMessages,this.messageTextMaxLength=e.messageTextMaxLength,this.socketServerEnabled=e.socketServerEnabled,this.socketServerHost=e.socketServerHost,this.socketServerPort=e.socketServerPort,this.socketServerChatID=e.socketServerChatID,this.DOMbuffering=!1,this.DOMbuffer="",this.retryTimerDelay=(6e3*this.inactiveTimeout-this.timerRate)/4+this.timerRate},initDirectories:function(){this.dirs={},this.dirs.emoticons=this.baseURL+"img/emoticons/",this.dirs.sounds=this.baseURL+"sounds/",this.dirs.flash=this.baseURL+"flash/"},initSettings:function(){var t,s,i,n,a,r,e=this.readCookie(this.sessionName+"_settings");if(this.settingsInitiated=!0,this.unusedSettings={},e)for(s=e.split("&"),t=0;t<s.length;t++)if(i=s[t].split("="),2===i.length){switch(n=i[0],a=this.decodeText(i[1])){case"true":a=!0;break;case"false":a=!1;break;case"null":a=null;break;default:r=parseFloat(a),isNaN(r)||(a=parseInt(r)===r?parseInt(r):r)}this.inArray(this.nonPersistentSettings,n)?this.unusedSettings[n]=a:this.settings[n]=a}},persistSettings:function(){var e;if(this.settingsInitiated){e=[];for(var t in this.settings){if(this.inArray(this.nonPersistentSettings,t)){if(!this.unusedSettings||!this.unusedSettings[t])continue;this.settings[t]=this.unusedSettings[t]}e.push(t+"="+this.encodeText(this.settings[t]))}this.createCookie(this.sessionName+"_settings",e.join("&"),this.cookieExpiration)}},getSettings:function(){return this.settings},getSetting:function(e){for(var t in this.settings)if(t===e)return this.settings[e];return null},setSetting:function(e,t){this.settings[e]=t},initializeSettings:function(){this.settings.persistFontColor&&this.settings.fontColor&&this.dom.inputField&&(this.dom.inputField.style.color=this.settings.fontColor)},initialize:function(){this.setUnloadHandler(),this.initializeDocumentNodes(),this.loadPageAttributes(),this.initEmoticons(),this.initColorCodes(),this.initializeSettings(),this.setSelectedStyle(),this.customInitialize(),this.setStatus("retrying"),"function"==typeof this.initializeFunction&&this.initializeFunction(),this.isCookieEnabled()?this.startChatOnLoad?this.startChat():(this.setStartChatHandler(),this.requestTeaserContent()):this.addChatBotMessageToChatList("/error CookiesRequired")},requestTeaserContent:function(){var e="&view=teaser";e+="&getInfos="+this.encodeText("userID,userName,userRole"),isNaN(parseInt(this.loginChannelID))?null!==this.loginChannelName&&(e+="&channelName="+this.encodeText(this.loginChannelName)):e+="&channelID="+this.loginChannelID,this.updateChat(e)},setStartChatHandler:function(){this.dom.inputField&&(this.dom.inputField.onfocus=function(){ajaxChat.startChat(),ajaxChat.dom.inputField.onfocus=""})},startChat:function(){this.chatStarted=!0,this.dom.inputField&&this.settings.autoFocus&&this.dom.inputField.focus(),this.loadFlashInterface(),this.startChatUpdate()},loadPageAttributes:function(){var e=document.getElementsByTagName("html")[0];this.langCode=e.getAttribute("lang")?e.getAttribute("lang"):"en",this.baseDirection=e.getAttribute("dir")?e.getAttribute("dir"):"ltr"},setLoadHandler:function(){var e=window.onload;window.onload="function"!=typeof e?function(){ajaxChat.initialize()}:function(){e(),ajaxChat.initialize()}},setUnloadHandler:function(){var e=window.onunload;window.onunload="function"!=typeof e?function(){ajaxChat.finalize()}:function(){ajaxChat.finalize(),e()}},updateDOM:function(e,t,s,i){var n=this.dom[e]?this.dom[e]:document.getElementById(e);if(n)try{n.cloneNode(!1).innerHTML=t,i?n.innerHTML=t:s?n.innerHTML=t+n.innerHTML:n.innerHTML+=t}catch(a){this.addChatBotMessageToChatList("/error DOMSyntax "+e),this.updateChatlistView()}},initializeDocumentNodes:function(){this.dom={};for(var e in this.domIDs)this.dom[e]=document.getElementById(this.domIDs[e])},initEmoticons:function(){this.DOMbuffer="";for(var e=0;e<this.emoticonCodes.length;e++)this.emoticonCodes[e]=this.encodeSpecialChars(this.emoticonCodes[e]),this.DOMbuffer=this.DOMbuffer+"<a href=\"javascript:ajaxChat.insertText('"+this.scriptLinkEncode(this.emoticonCodes[e])+'\');"><img src="'+this.dirs.emoticons+this.emoticonFiles[e]+'" alt="'+this.emoticonCodes[e]+'" title="'+this.emoticonCodes[e]+'"/></a>';this.dom.emoticonsContainer&&this.updateDOM("emoticonsContainer",this.DOMbuffer),this.DOMbuffer=""},initColorCodes:function(){if(this.dom.colorCodesContainer){this.DOMbuffer="";for(var e=0;e<this.colorCodes.length;e++)this.DOMbuffer=this.DOMbuffer+"<a href=\"javascript:ajaxChat.setFontColor('"+this.colorCodes[e]+'\');" style="background-color:'+this.colorCodes[e]+';" title="'+this.colorCodes[e]+'"></a>\n';this.updateDOM("colorCodesContainer",this.DOMbuffer),this.DOMbuffer=""}},startChatUpdate:function(){var e="userID,userName,userRole,channelID,channelName";this.socketServerEnabled&&(e+=",socketRegistrationID");var t="&getInfos="+this.encodeText(e);isNaN(parseInt(this.loginChannelID))?null!==this.loginChannelName&&(t+="&channelName="+this.encodeText(this.loginChannelName)):t+="&channelID="+this.loginChannelID,this.updateChat(t)},updateChat:function(e){var t=this.ajaxURL+"&lastID="+this.lastID;e&&(t+=e),this.makeRequest(t,"GET",null)},loadFlashInterface:function(){this.dom.flashInterfaceContainer&&(this.updateDOM("flashInterfaceContainer",'<object id="ajaxChatFlashInterface" style="position:absolute; left:-100px;" classid="clsid:D27CDB6E-AE6D-11cf-96B8-444553540000" codebase="'+window.location.protocol+'//download.macromedia.com/pub/shockwave/cabs/flash/swflash.cab#version=9,0,0,0" height="1" width="1"><param name="flashvars" value="bridgeName=ajaxChat"/><param name="src" value="'+this.dirs.flash+'FABridge.swf"/><embed name="ajaxChatFlashInterface" type="application/x-shockwave-flash" pluginspage="'+window.location.protocol+'//www.macromedia.com/go/getflashplayer" src="'+this.dirs.flash+'FABridge.swf" height="1" width="1" flashvars="bridgeName=ajaxChat"/></object>'),FABridge.addInitializationCallback("ajaxChat",this.flashInterfaceLoadCompleteHandler))},flashInterfaceLoadCompleteHandler:function(){ajaxChat.initializeFlashInterface()},initializeFlashInterface:function(){this.socketServerEnabled&&(this.socketTimerRate=60*(this.inactiveTimeout-1)*1e3,this.socketConnect()),this.loadSounds(),this.initializeCustomFlashInterface()},socketConnect:function(){if(!this.socketIsConnected)try{!this.socket&&FABridge.ajaxChat&&(this.socket=FABridge.ajaxChat.create("flash.net.XMLSocket"),this.socket.addEventListener("connect",this.socketConnectHandler),this.socket.addEventListener("close",this.socketCloseHandler),this.socket.addEventListener("data",this.socketDataHandler),this.socket.addEventListener("ioError",this.socketIOErrorHandler),this.socket.addEventListener("securityError",this.socketSecurityErrorHandler)),this.socket.connect(this.socketServerHost,this.socketServerPort)}catch(e){}clearTimeout(this.socketReconnectTimer),this.socketReconnectTimer=null},socketConnectHandler:function(){ajaxChat.socketIsConnected=!0,setTimeout(ajaxChat.socketRegister,0)},socketCloseHandler:function(){ajaxChat.socketIsConnected=!1,ajaxChat.socket&&(clearTimeout(ajaxChat.timer),ajaxChat.updateChat(null))},socketDataHandler:function(e){ajaxChat.socketUpdate(e.getData())},socketIOErrorHandler:function(){setTimeout(function(){ajaxChat.addChatBotMessageToChatList("/error SocketIO")},0),setTimeout(ajaxChat.updateChatlistView,1)},socketSecurityErrorHandler:function(){setTimeout(function(){ajaxChat.addChatBotMessageToChatList("/error SocketSecurity")},0),setTimeout(ajaxChat.updateChatlistView,1)},socketRegister:function(){if(this.socket&&this.socketIsConnected)try{this.socket.send('<register chatID="'+this.socketServerChatID+'" userID="'+this.userID+'" regID="'+this.socketRegistrationID+'"/>')}catch(e){}},loadXML:function(e){if(!arguments.callee.parser)try{arguments.callee.parser=new DOMParser}catch(t){var s=function(){};s.prototype.parseFromString="Microsoft Internet Explorer"===navigator.appName?function(e){return arguments.callee.XMLDOM||(arguments.callee.XMLDOM=new ActiveXObject("Microsoft.XMLDOM")),arguments.callee.XMLDOM.loadXML(e),arguments.callee.XMLDOM}:function(e){return arguments.callee.httpRequest||(arguments.callee.httpRequest=new XMLHttpRequest),arguments.callee.httpRequest.open("GET","data:text/xml;charset=utf-8,"+encodeURIComponent(e),!1),arguments.callee.httpRequest.send(null),arguments.callee.httpRequest.responseXML},arguments.callee.parser=new s}return arguments.callee.parser.parseFromString(e,"text/xml")},socketUpdate:function(e){var t=this.loadXML(e);if(t&&(this.handleOnlineUsers(t.getElementsByTagName("user")),(this.showChannelMessages||"1"!==t.firstChild.getAttribute("mode"))&&!this.channelSwitch)){var s=t.firstChild.getAttribute("channelID");(s===this.channelID||parseInt(s)===parseInt(this.userID)+this.privateMessageDiff)&&this.handleChatMessages(t.getElementsByTagName("message"))}},setAudioVolume:function(e){if(e=parseFloat(e),!isNaN(e)){0>e?e=0:e>1&&(e=1),this.settings.audioVolume=e;try{this.soundTransform||(this.soundTransform=FABridge.ajaxChat.create("flash.media.SoundTransform")),this.soundTransform.setVolume(e)}catch(t){}}},loadSounds:function(){try{this.setAudioVolume(this.settings.audioVolume),this.sounds={};var e,t;for(var s in this.soundFiles)e=FABridge.ajaxChat.create("flash.media.Sound"),e.addEventListener("complete",this.soundLoadCompleteHandler),e.addEventListener("ioError",this.soundIOErrorHandler),t=FABridge.ajaxChat.create("flash.net.URLRequest"),t.setUrl(this.dirs.sounds+this.soundFiles[s]),e.load(t)}catch(i){alert(i)}},soundLoadCompleteHandler:function(e){var t=e.getTarget();for(var s in ajaxChat.soundFiles)new RegExp(ajaxChat.soundFiles[s]).test(t.getUrl())&&(ajaxChat.sounds[s]=t)},soundIOErrorHandler:function(){setTimeout(function(){ajaxChat.addChatBotMessageToChatList("/error SoundIO")},0),setTimeout(ajaxChat.updateChatlistView,1)},soundPlayCompleteHandler:function(){},playSound:function(e){if(this.sounds&&this.sounds[e])try{return this.sounds[e].play(0,0,this.soundTransform)}catch(t){}return null},playSoundOnNewMessage:function(e,t,s,i,n){if(this.settings.audio&&this.sounds&&this.lastID&&!this.channelSwitch)switch(e){case this.chatBotID:var o=n.split(" ",1);switch(o[0]){case"/login":case"/channelEnter":this.playSound(this.settings.soundEnter);break;case"/logout":case"/channelLeave":case"/kick":this.playSound(this.settings.soundLeave);break;case"/error":this.playSound(this.settings.soundError);break;default:this.playSound(this.settings.soundChatBot)}break;case this.userID:this.playSound(this.settings.soundSend);break;default:this.playSound(this.settings.soundReceive)}},fillSoundSelection:function(e,t){var s=document.getElementById(e),i=1;for(var n in this.soundFiles)s.options[i]=new Option(n,n),n===t&&(s.options[i].selected=!0),i++},setStatus:function(e){("retrying"!==this.requestStatus||"ok"===e)&&(this.requestStatus=e);var t=document.getElementById("statusIconContainer");if(t)switch(this.requestStatus){case"ok":this.setClass(t,"statusContainerOff");break;case"waiting":this.setClass(t,"statusContainerOn");break;case"retrying":this.setClass(t,"statusContainerAlert")}},forceNewRequest:function(){ajaxChat.updateChat(null),ajaxChat.setStatus("retrying")},getHttpRequest:function(e){if(!this.httpRequest[e])if(window.XMLHttpRequest)this.httpRequest[e]=new XMLHttpRequest,this.httpRequest[e].overrideMimeType&&this.httpRequest[e].overrideMimeType("text/xml");else if(window.ActiveXObject)try{this.httpRequest[e]=new ActiveXObject("Msxml2.XMLHTTP")}catch(t){try{this.httpRequest[e]=new ActiveXObject("Microsoft.XMLHTTP")}catch(t){}}return this.httpRequest[e]},makeRequest:function(e,t,s){var i;this.setStatus("waiting");try{s?(!arguments.callee.identifier||arguments.callee.identifier>50?arguments.callee.identifier=1:arguments.callee.identifier++,i=arguments.callee.identifier):i=0,this.retryTimer=setTimeout(ajaxChat.forceNewRequest,ajaxChat.retryTimerDelay),this.getHttpRequest(i).open(t,e,!0),this.getHttpRequest(i).onreadystatechange=function(){try{ajaxChat.handleResponse(i)}catch(e){try{clearTimeout(ajaxChat.timer)}catch(e){}try{s&&(ajaxChat.addChatBotMessageToChatList("/error ConnectionTimeout"),ajaxChat.setStatus("retrying"),ajaxChat.updateChatlistView())}catch(e){}try{ajaxChat.timer=setTimeout(function(){ajaxChat.updateChat(null)},ajaxChat.timerRate)}catch(e){}}},"POST"===t&&this.getHttpRequest(i).setRequestHeader("Content-Type","application/x-www-form-urlencoded"),this.getHttpRequest(i).send(s)}catch(n){clearTimeout(this.timer),s&&(this.addChatBotMessageToChatList("/error ConnectionTimeout"),ajaxChat.setStatus("retrying"),this.updateChatlistView()),this.timer=setTimeout(function(){ajaxChat.updateChat(null)},this.timerRate)}},handleResponse:function(e){var t;if(4===this.getHttpRequest(e).readyState){if(200!==this.getHttpRequest(e).status)return 0===this.getHttpRequest(e).status?(this.setStatus("waiting"),this.updateChatlistView(),!1):(this.addChatBotMessageToChatList("/error ConnectionStatus "+this.getHttpRequest(e).status),this.setStatus("retrying"),this.updateChatlistView(),!1);clearTimeout(ajaxChat.retryTimer),t=this.getHttpRequest(e).responseXML,ajaxChat.setStatus("ok")}return t?(this.handleXML(t),!0):!1},handleXML:function(e){this.handleInfoMessages(e.getElementsByTagName("info")),this.handleOnlineUsers(e.getElementsByTagName("user")),this.handleChatMessages(e.getElementsByTagName("message")),this.channelSwitch=null,this.setChatUpdateTimer()},setChatUpdateTimer:function(){if(clearTimeout(this.timer),this.chatStarted){var e;this.socketIsConnected?e=this.socketTimerRate:(e=this.timerRate,this.socketServerEnabled&&!this.socketReconnectTimer&&(this.socketReconnectTimer=setTimeout(ajaxChat.socketConnect,6e4))),this.timer=setTimeout(function(){ajaxChat.updateChat(null)},e)}},handleInfoMessages:function(e){for(var t,s,i=0;i<e.length;i++)t=e[i].getAttribute("type"),s=e[i].firstChild?e[i].firstChild.nodeValue:"",this.handleInfoMessage(t,s)},handleInfoMessage:function(e,t){switch(e){case"channelSwitch":this.clearChatList(),this.clearOnlineUsersList(),this.setSelectedChannel(t),this.channelName=t,this.channelSwitch=!0;break;case"channelName":this.setSelectedChannel(t),this.channelName=t;break;case"channelID":this.channelID=t;break;case"userID":this.userID=t;break;case"userName":this.userName=t,this.encodedUserName=this.scriptLinkEncode(this.userName),this.userNodeString=null;break;case"userRole":this.userRole=t;break;case"logout":return void this.handleLogout(t);case"socketRegistrationID":this.socketRegistrationID=t,this.socketRegister();default:this.handleCustomInfoMessage(e,t)}},handleOnlineUsers:function(e){if(e.length){var t,s,i,n,a,r=[];for(a=0;a<e.length;a++)s=e[a].getAttribute("userID"),i=e[a].firstChild?e[a].firstChild.nodeValue:"",n=e[a].getAttribute("userRole"),r.push(s),t=this.arraySearch(s,this.usersList),t===!1?this.addUserToOnlineList(s,i,n):this.userNamesList[t]!==i&&(this.removeUserFromOnlineList(s,t),this.addUserToOnlineList(s,i,n));for(a=0;a<this.usersList.length;a++)this.inArray(r,this.usersList[a])||this.removeUserFromOnlineList(this.usersList[a],a);this.setOnlineListRowClasses()}},handleChatMessages:function(e){var t,s,i,n,a;if(e.length){for(a=0;a<e.length;a++)this.DOMbuffering=!0,t=e[a].getElementsByTagName("username")[0],s=t.firstChild?t.firstChild.nodeValue:"",i=e[a].getElementsByTagName("text")[0],n=i.firstChild?i.firstChild.nodeValue:"",a===e.length-1&&(this.DOMbuffering=!1),this.addMessageToChatList(e[a].getAttribute("userID"),s,e[a].getAttribute("userRole"),e[a].getAttribute("id"),n,e[a].getAttribute("channelID"),e[a].getAttribute("ip"));this.DOMbuffering=!1,this.updateChatlistView(),this.lastID=e[e.length-1].getAttribute("id")}},setSelectedChannel:function(e){var s,i,n,t=!1;if(this.dom.channelSelection){for(e=this.decodeSpecialChars(e),s=0;s<this.dom.channelSelection.options.length;s++)if(this.dom.channelSelection.options[s].value===e){this.dom.channelSelection.options[s].selected=!0,t=!0;break}t||(i=document.createElement("option"),n=document.createTextNode(e),i.appendChild(n),i.setAttribute("value",e),i.setAttribute("selected","selected"),this.dom.channelSelection.appendChild(i))}},removeUserFromOnlineList:function(e,t){this.usersList.splice(t,1),this.userNamesList.splice(t,1),this.dom.onlineList&&this.dom.onlineList.removeChild(this.getUserNode(e))},addUserToOnlineList:function(e,t,s){this.usersList.push(e),this.userNamesList.push(t),this.dom.onlineList&&this.updateDOM("onlineList",this.getUserNodeString(e,t,s),this.userID===e)},getUserNodeString:function(e,t,s){var i,n;return this.userNodeString&&e===this.userID?this.userNodeString:(i=this.scriptLinkEncode(t),n='<div id="'+this.getUserDocumentID(e)+'"><a href="javascript:ajaxChat.toggleUserMenu(\''+this.getUserMenuDocumentID(e)+"', '"+i+"', "+e+');" class="'+this.getRoleClass(s)+'" title="'+this.lang.toggleUserMenu.replace(/%s/,t)+'">'+t+'</a><ul class="userMenu" id="'+this.getUserMenuDocumentID(e)+'"'+(e===this.userID?">"+this.getUserNodeStringItems(i,e,!1):' style="display:none;">')+"</ul></div>",e===this.userID&&(this.userNodeString=n),n)},toggleUserMenu:function(e,t,s){var i=!1;e.indexOf("ium")>=0&&(i=!0),document.getElementById(e).firstChild||this.updateDOM(e,this.getUserNodeStringItems(this.encodeText(this.addSlashes(this.getScriptLinkValue(t))),s,i),!1,!0),this.showHide(e),this.dom.chatList.scrollTop=this.dom.chatList.scrollHeight},getUserNodeStringItems:function(e,t,s){var i;return e!==this.encodedUserName?(i="<li><a href=\"javascript:ajaxChat.insertMessageWrapper('/msg "+e+" ');\">"+this.lang.userMenuSendPrivateMessage+"</a></li><li><a href=\"javascript:ajaxChat.insertMessageWrapper('/describe "+e+" ');\">"+this.lang.userMenuDescribe+"</a></li><li><a href=\"javascript:ajaxChat.sendMessageWrapper('/query "+e+"');\">"+this.lang.userMenuOpenPrivateChannel+"</a></li><li><a href=\"javascript:ajaxChat.sendMessageWrapper('/query');\">"+this.lang.userMenuClosePrivateChannel+"</a></li><li><a href=\"javascript:ajaxChat.sendMessageWrapper('/ignore "+e+"');\">"+this.lang.userMenuIgnore+"</a></li>",s&&(i+="<li><a href=\"javascript:ajaxChat.sendMessageWrapper('/invite "+e+"');\">"+this.lang.userMenuInvite+"</a></li><li><a href=\"javascript:ajaxChat.sendMessageWrapper('/uninvite "+e+"');\">"+this.lang.userMenuUninvite+"</a></li><li><a href=\"javascript:ajaxChat.sendMessageWrapper('/whereis "+e+"');\">"+this.lang.userMenuWhereis+"</a></li>"),("2"===this.userRole||"3"===this.userRole)&&(i+="<li><a href=\"javascript:ajaxChat.insertMessageWrapper('/kick "+e+" ');\">"+this.lang.userMenuKick+"</a></li><li><a href=\"javascript:ajaxChat.sendMessageWrapper('/whois "+e+"');\">"+this.lang.userMenuWhois+"</a></li>")):(i="<li><a href=\"javascript:ajaxChat.sendMessageWrapper('/quit');\">"+this.lang.userMenuLogout+"</a></li><li><a href=\"javascript:ajaxChat.sendMessageWrapper('/who');\">"+this.lang.userMenuWho+"</a></li><li><a href=\"javascript:ajaxChat.sendMessageWrapper('/ignore');\">"+this.lang.userMenuIgnoreList+"</a></li><li><a href=\"javascript:ajaxChat.sendMessageWrapper('/list');\">"+this.lang.userMenuList+"</a></li><li><a href=\"javascript:ajaxChat.insertMessageWrapper('/action ');\">"+this.lang.userMenuAction+"</a></li><li><a href=\"javascript:ajaxChat.insertMessageWrapper('/roll ');\">"+this.lang.userMenuRoll+"</a></li><li><a href=\"javascript:ajaxChat.insertMessageWrapper('/nick ');\">"+this.lang.userMenuNick+"</a></li>",("1"===this.userRole||"2"===this.userRole||"3"===this.userRole)&&(i+="<li><a href=\"javascript:ajaxChat.sendMessageWrapper('/join');\">"+this.lang.userMenuEnterPrivateRoom+"</a></li>",("2"===this.userRole||"3"===this.userRole)&&(i+="<li><a href=\"javascript:ajaxChat.sendMessageWrapper('/bans');\">"+this.lang.userMenuBans+"</a></li>"))),i+=this.getCustomUserMenuItems(e,t)},setOnlineListRowClasses:function(){if(this.dom.onlineList)for(var e=this.dom.onlineList.firstChild,t=!1;e;)this.setClass(e,t?"rowEven":"rowOdd"),e=e.nextSibling,t=!t},clearChatList:function(){for(;this.dom.chatList.hasChildNodes();)this.dom.chatList.removeChild(this.dom.chatList.firstChild)},clearOnlineUsersList:function(){if(this.usersList=[],this.userNamesList=[],this.dom.onlineList)for(;this.dom.onlineList.hasChildNodes();)this.dom.onlineList.removeChild(this.dom.onlineList.firstChild)},getEncodedChatBotName:function(){return"undefined"==typeof arguments.callee.encodedChatBotName&&(arguments.callee.encodedChatBotName=this.encodeSpecialChars(this.chatBotName)),arguments.callee.encodedChatBotName},addChatBotMessageToChatList:function(e){this.addMessageToChatList(new Date,this.chatBotID,this.getEncodedChatBotName(),4,null,e,null)},addMessageToChatList:function(e,t,s,i,n,a,r){this.getMessageNode(i)||this.onNewMessage(e,t,s,i,n,a,r)&&(this.DOMbufferRowClass="rowEven"===this.DOMbufferRowClass?"rowOdd":"rowEven",this.DOMbuffer=this.DOMbuffer+this.getChatListMessageString(e,t,s,i,n,a,r),this.DOMbuffering||(this.updateDOM("chatList",this.DOMbuffer),this.DOMbuffer=""))},getChatListMessageString:function(e,t,s,i,n,a,r){var h,o=this.DOMbufferRowClass,l=this.getRoleClass(s);0===n.indexOf("/action")||0===n.indexOf("/me")||0===n.indexOf("/privaction")?(l+=" action",h=" "):h=": ";var c="";return this.userName==t&&(c=" logged-in",t="You"),'<div id="'+this.getMessageDocumentID(i)+'" class="'+o+c+'">'+this.getDeletionLink(i,e,s,a)+'<span class="'+l+'"'+this.getChatListUserNameTitle(e,t,s,r)+' dir="'+this.baseDirection+'" onclick="ajaxChat.insertText(this.firstChild.nodeValue);">'+t+"</span>"+h+this.replaceText(n)+"</div>"},getChatListUserNameTitle:function(e,t,s,i){return null!==i?' title="IP: '+i+'"':""},getMessageDocumentID:function(e){return null===e?"ajaxChat_lm_"+this.localID++:"ajaxChat_m_"+e},getMessageNode:function(e){return null===e?null:document.getElementById(this.getMessageDocumentID(e))},getUserDocumentID:function(e){return"ajaxChat_u_"+e},getUserNode:function(e){return document.getElementById(this.getUserDocumentID(e))},getUserMenuDocumentID:function(e){return"ajaxChat_um_"+e},getInlineUserMenuDocumentID:function(e,t){return"ajaxChat_ium_"+e+"_"+t},getDeletionLink:function(e,t,s,i){return null!==e&&this.isAllowedToDeleteMessage(e,t,s,i)?(arguments.callee.deleteMessage||(arguments.callee.deleteMessage=this.encodeSpecialChars(this.lang.deleteMessage)),'<a class="delete" title="'+arguments.callee.deleteMessage+'" href="javascript:ajaxChat.deleteMessage('+e+');"> </a>'):""},isAllowedToDeleteMessage:function(e,t,s,i){return("1"===this.userRole&&this.allowUserMessageDelete&&(t===this.userID||parseInt(i)===parseInt(this.userID)+this.privateMessageDiff||parseInt(i)===parseInt(this.userID)+this.privateChannelDiff)||"2"===this.userRole)&&"3"!==s&&"4"!==s||"3"===this.userRole?!0:!1},onNewMessage:function(e,t,s,i,n,a,r){return this.customOnNewMessage(e,t,s,i,n,a,r)?this.ignoreMessage(e,t,s,i,n,a,r)?!1:this.parseDeleteMessageCommand(n)?!1:(this.blinkOnNewMessage(e,t,s,i,n,a,r),this.playSoundOnNewMessage(e,t,s,i,n,a,r),!0):!1},parseDeleteMessageCommand:function(e){if(0===e.indexOf("/delete")){var t=e.substr(8),s=this.getMessageNode(t);if(s){var i=s.nextSibling;try{this.dom.chatList.removeChild(s),i&&this.updateChatListRowClasses(i)}catch(n){}}return!0}return!1},blinkOnNewMessage:function(e,t){this.settings.blink&&this.lastID&&!this.channelSwitch&&e!==this.userID&&(clearInterval(this.blinkInterval),this.blinkInterval=setInterval("ajaxChat.blinkUpdate('"+this.addSlashes(this.decodeSpecialChars(t))+"')",this.settings.blinkInterval))},blinkUpdate:function(e){this.originalDocumentTitle||(this.originalDocumentTitle=document.title),arguments.callee.blink?arguments.callee.blink>this.settings.blinkIntervalNumber?(clearInterval(this.blinkInterval),document.title=this.originalDocumentTitle,arguments.callee.blink=0):(document.title=arguments.callee.blink%2!==0?"[@ ] "+e+" - "+this.originalDocumentTitle:"[ @] "+e+" - "+this.originalDocumentTitle,arguments.callee.blink++):(document.title="[@ ] "+e+" - "+this.originalDocumentTitle,arguments.callee.blink=1)},updateChatlistView:function(){if(this.dom.chatList.childNodes&&this.settings.maxMessages)for(;this.dom.chatList.childNodes.length>this.settings.maxMessages;)this.dom.chatList.removeChild(this.dom.chatList.firstChild);this.settings.autoScroll&&(this.dom.chatList.scrollTop=this.dom.chatList.scrollHeight)},encodeText:function(e){return encodeURIComponent(e)},decodeText:function(e){return decodeURIComponent(e)},utf8Encode:function(e){for(var t="",s=0;s<e.length;s++){var i=e.charCodeAt(s);128>i?t+=String.fromCharCode(i):i>127&&2048>i?(t+=String.fromCharCode(i>>6|192),t+=String.fromCharCode(63&i|128)):(t+=String.fromCharCode(i>>12|224),t+=String.fromCharCode(i>>6&63|128),t+=String.fromCharCode(63&i|128))}return t},utf8Decode:function(e){for(var s,i,n,t="",a=0;a<e.length;)s=e.charCodeAt(a),128>s?(t+=String.fromCharCode(s),a++):s>191&&224>s?(i=e.charCodeAt(a+1),t+=String.fromCharCode((31&s)<<6|63&i),a+=2):(i=e.charCodeAt(a+1),n=e.charCodeAt(a+2),t+=String.fromCharCode((15&s)<<12|(63&i)<<6|63&n),a+=3);return t},encodeSpecialChars:function(e){return e.replace(/[&<>'"]/g,this.encodeSpecialCharsCallback)},encodeSpecialCharsCallback:function(e){switch(e){case"&":return"&amp;";case"<":return"&lt;";case">":return"&gt;";case"'":return"&#39;";case'"':return"&quot;";default:return e}},decodeSpecialChars:function(e){var t=new RegExp("(&amp;)|(&lt;)|(&gt;)|(&#39;)|(&quot;)","g");return e.replace(t,this.decodeSpecialCharsCallback)},decodeSpecialCharsCallback:function(e){switch(e){case"&amp;":return"&";case"&lt;":return"<";case"&gt;":return">";case"&#39;":return"'";case"&quot;":return'"';default:return e}},inArray:function(e,t){for(var s=e.length;s--;)if(e[s]===t)return!0;return!1},arraySearch:function(e,t){for(var s=t.length;s--;)if(t[s]===e)return s;return!1},stripTags:function(e){return arguments.callee.regExp||(arguments.callee.regExp=new RegExp("<\\/?[^>]+?>","g")),e.replace(arguments.callee.regExp,"")},stripBBCodeTags:function(e){return arguments.callee.regExp||(arguments.callee.regExp=new RegExp("\\[\\/?[^\\]]+?\\]","g")),e.replace(arguments.callee.regExp,"")},escapeRegExp:function(e){if(!arguments.callee.regExp){var t=new Array("^","$","*","+","?",".","|","/","(",")","[","]","{","}","\\");arguments.callee.regExp=new RegExp("(\\"+t.join("|\\")+")","g")}return e.replace(arguments.callee.regExp,"\\$1")},addSlashes:function(e){return e.replace(/\\/g,"\\\\").replace(/\'/g,"\\'")},removeSlashes:function(e){return e.replace(/\\\\/g,"\\").replace(/\\\'/g,"'")},formatDate:function(e,t){return t=null==t?new t:t,e.replace(/%Y/g,t.getFullYear()).replace(/%m/g,this.addLeadingZero(t.getMonth()+1)).replace(/%d/g,this.addLeadingZero(t.getDate())).replace(/%H/g,this.addLeadingZero(t.getHours())).replace(/%i/g,this.addLeadingZero(t.getMinutes())).replace(/%s/g,this.addLeadingZero(t.getSeconds()))},addLeadingZero:function(e){return e=e.toString(),e.length<2&&(e="0"+e),e},getUserIDFromUserName:function(e){var t=this.arraySearch(e,this.userNamesList);return t!==!1?this.usersList[t]:null},getUserNameFromUserID:function(e){var t=this.arraySearch(e,this.usersList);return t!==!1?this.userNamesList[t]:null},getRoleClass:function(e){switch(parseInt(e)){case 0:return"guest";case 1:return"user";case 2:return"moderator";case 3:return"admin";case 4:return"chatBot";default:return"default"}},handleInputFieldKeyPress:function(e){if(13===e.keyCode&&!e.shiftKey){this.sendMessage();try{e.preventDefault()}catch(t){e.returnValue=!1}return!1}return!0},handleInputFieldKeyUp:function(){this.updateMessageLengthCounter()},updateMessageLengthCounter:function(){this.dom.messageLengthCounter&&this.updateDOM("messageLengthCounter",this.dom.inputField.value.length+"/"+this.messageTextMaxLength,!1,!0)},sendMessage:function(e){if(e=e?e:this.dom.inputField.value){if(e=this.parseInputMessage(e)){clearTimeout(this.timer);var t="lastID="+this.lastID+"&text="+this.encodeText(e);this.makeRequest(this.ajaxURL,"POST",t)}this.dom.inputField.value="",this.dom.inputField.focus(),this.updateMessageLengthCounter()}},parseInputMessage:function(e){var t;if("/"===e.charAt(0)){switch(t=e.split(" "),t[0]){case"/ignore":e=this.parseIgnoreInputCommand(e,t);break;case"/clear":return this.clearChatList(),!1;default:e=this.parseCustomInputCommand(e,t)}e&&this.settings.persistFontColor&&this.settings.fontColor&&(e=this.assignFontColorToCommandMessage(e,t))}else e=this.parseCustomInputMessage(e),e&&this.settings.persistFontColor&&this.settings.fontColor&&(e=this.assignFontColorToMessage(e));return e},assignFontColorToMessage:function(e){return"[color="+this.settings.fontColor+"]"+e+"[/color]"},assignFontColorToCommandMessage:function(e,t){switch(t[0]){case"/msg":case"/describe":if(t.length>2)return t[0]+" "+t[1]+" [color="+this.settings.fontColor+"]"+t.slice(2).join(" ")+"[/color]";break;case"/me":case"/action":if(t.length>1)return t[0]+" [color="+this.settings.fontColor+"]"+t.slice(1).join(" ")+"[/color]"}return e},parseIgnoreInputCommand:function(e,t){var s,n,i=this.getIgnoredUserNames();if(t.length>1){if(s=this.encodeSpecialChars(t[1]),s===this.userName||s===this.getEncodedChatBotName())return this.parseIgnoreInputCommand(null,new Array("/ignore"));if(i.length>0)for(n=i.length;n--;)if(i[n]===s)return i.splice(n,1),this.addChatBotMessageToChatList("/ignoreRemoved "+s),this.setIgnoredUserNames(i),this.updateChatlistView(),null;i.push(s),this.addChatBotMessageToChatList("/ignoreAdded "+s),this.setIgnoredUserNames(i)
}else this.addChatBotMessageToChatList(0===i.length?"/ignoreListEmpty -":"/ignoreList "+i.join(" "));return this.updateChatlistView(),null},getIgnoredUserNames:function(){var e;return this.ignoredUserNames||(e=this.getSetting("ignoredUserNames"),this.ignoredUserNames=e?e.split(" "):[]),this.ignoredUserNames},setIgnoredUserNames:function(e){this.ignoredUserNames=e,this.setSetting("ignoredUserNames",e.join(" "))},ignoreMessage:function(e,t,s,i,n){var o;if(e===this.chatBotID&&"/"===n.charAt(0)&&(o=n.split(" "),o.length>1))switch(o[0]){case"/invite":case"/uninvite":case"/roll":t=o[1]}return this.inArray(this.getIgnoredUserNames(),t)?!0:!1},deleteMessage:function(e){var s,i,t=this.getMessageNode(e);if(t)if(s=this.getClass(t),this.setClass(t,s+" deleteSelected"),confirm(this.lang.deleteMessageConfirm)){i=t.nextSibling;try{this.dom.chatList.removeChild(t),i&&this.updateChatListRowClasses(i),this.updateChat("&delete="+e)}catch(n){this.setClass(t,s)}}else this.setClass(t,s)},updateChatListRowClasses:function(e){var t,s;if(e||(e=this.dom.chatList.firstChild),e)for(t=e.previousSibling,s=t&&"rowOdd"===this.getClass(t)?!0:!1;e;)this.setClass(e,s?"rowEven":"rowOdd"),e=e.nextSibling,s=!s},getClass:function(e){return"undefined"!=typeof e.className?e.className:e.getAttribute("class")},setClass:function(e,t){"undefined"!=typeof e.className?e.className=t:e.setAttribute("class",t)},scriptLinkEncode:function(e){return this.encodeText(this.addSlashes(this.decodeSpecialChars(e)))},scriptLinkDecode:function(e){return this.encodeSpecialChars(this.removeSlashes(this.decodeText(e)))},getScriptLinkValue:function(e){if("undefined"!=typeof arguments.callee.utf8Decode)return arguments.callee.utf8Decode?this.utf8Decode(e):e;switch(navigator.appName){case"Microsoft Internet Explorer":case"Opera":return arguments.callee.utf8Decode=!0,this.utf8Decode(e);default:return arguments.callee.utf8Decode=!1,e}},sendMessageWrapper:function(e){this.sendMessage(this.getScriptLinkValue(e))},insertMessageWrapper:function(e){this.insertText(this.getScriptLinkValue(e),!0)},switchChannel:function(e){if(!this.chatStarted)return this.clearChatList(),this.channelSwitch=!0,this.loginChannelID=null,this.loginChannelName=e,void this.requestTeaserContent();clearTimeout(this.timer);var t="lastID="+this.lastID+"&channelName="+this.encodeText(e);this.makeRequest(this.ajaxURL,"POST",t),this.dom.inputField&&this.settings.autoFocus&&this.dom.inputField.focus()},logout:function(){clearTimeout(this.timer);var e="logout=true";this.makeRequest(this.ajaxURL,"POST",e)},handleLogout:function(e){window.location.href=e},toggleSetting:function(e,t){this.setSetting(e,!this.getSetting(e)),t&&this.updateButton(e,t)},updateButton:function(e,t){var s=document.getElementById(t);s&&this.setClass(s,this.getSetting(e)?"button":"button off")},showHide:function(e,t,s){var i=document.getElementById(e);i&&(i.style.display=t?t:"none"===i.style.display?s?"inline":"block":"none")},setPersistFontColor:function(e){this.settings.persistFontColor=e,this.settings.persistFontColor||(this.settings.fontColor=null,this.dom.inputField&&(this.dom.inputField.style.color=""))},setFontColor:function(e){this.settings.persistFontColor?(this.settings.fontColor=e,this.dom.inputField&&(this.dom.inputField.style.color=e),this.dom.colorCodesContainer&&(this.dom.colorCodesContainer.style.display="none",this.dom.inputField&&this.dom.inputField.focus())):this.insert("[color="+e+"]","[/color]")},insertText:function(e,t){t&&(this.dom.inputField.value=""),this.insert(e,"")},insertBBCode:function(e){switch(e){case"url":var t=prompt(this.lang.urlDialog,"http://");t?this.insert("[url="+t+"]","[/url]"):this.dom.inputField.focus();break;default:this.insert("["+e+"]","[/"+e+"]")}},insert:function(e,t){if(this.dom.inputField.focus(),"undefined"!=typeof document.selection){var s=document.selection.createRange(),i=s.text;s.text=e+i+t,s=document.selection.createRange(),0===i.length?s.move("character",-t.length):s.moveStart("character",e.length+i.length+t.length),s.select()}else if("undefined"!=typeof this.dom.inputField.selectionStart){var n=this.dom.inputField.selectionStart,a=this.dom.inputField.selectionEnd,i=this.dom.inputField.value.substring(n,a);this.dom.inputField.value=this.dom.inputField.value.substr(0,n)+e+i+t+this.dom.inputField.value.substr(a);var r;r=0===i.length?n+e.length:n+e.length+i.length+t.length,this.dom.inputField.selectionStart=r,this.dom.inputField.selectionEnd=r}else{var r=this.dom.inputField.value.length;this.dom.inputField.value=this.dom.inputField.value.substr(0,r)+e+t+this.dom.inputField.value.substr(r)}},replaceText:function(e){try{e=this.replaceLineBreaks(e),"/"===e.charAt(0)?e=this.replaceCommands(e):(e=this.replaceBBCode(e),e=this.replaceHyperLinks(e),e=this.replaceEmoticons(e)),e=this.breakLongWords(e),e=this.replaceCustomText(e)}catch(t){}return e},replaceCommands:function(e){try{if("/"!==e.charAt(0))return e;var t=e.split(" ");switch(t[0]){case"/login":return this.replaceCommandLogin(t);case"/logout":return this.replaceCommandLogout(t);case"/channelEnter":return this.replaceCommandChannelEnter(t);case"/channelLeave":return this.replaceCommandChannelLeave(t);case"/privmsg":return this.replaceCommandPrivMsg(t);case"/privmsgto":return this.replaceCommandPrivMsgTo(t);case"/privaction":return this.replaceCommandPrivAction(t);case"/privactionto":return this.replaceCommandPrivActionTo(t);case"/me":case"/action":return this.replaceCommandAction(t);case"/invite":return this.replaceCommandInvite(t);case"/inviteto":return this.replaceCommandInviteTo(t);case"/uninvite":return this.replaceCommandUninvite(t);case"/uninviteto":return this.replaceCommandUninviteTo(t);case"/queryOpen":return this.replaceCommandQueryOpen(t);case"/queryClose":return this.replaceCommandQueryClose(t);case"/ignoreAdded":return this.replaceCommandIgnoreAdded(t);case"/ignoreRemoved":return this.replaceCommandIgnoreRemoved(t);case"/ignoreList":return this.replaceCommandIgnoreList(t);case"/ignoreListEmpty":return this.replaceCommandIgnoreListEmpty(t);case"/kick":return this.replaceCommandKick(t);case"/who":return this.replaceCommandWho(t);case"/whoChannel":return this.replaceCommandWhoChannel(t);case"/whoEmpty":return this.replaceCommandWhoEmpty(t);case"/list":return this.replaceCommandList(t);case"/bans":return this.replaceCommandBans(t);case"/bansEmpty":return this.replaceCommandBansEmpty(t);case"/unban":return this.replaceCommandUnban(t);case"/whois":return this.replaceCommandWhois(t);case"/whereis":return this.replaceCommandWhereis(t);case"/roll":return this.replaceCommandRoll(t);case"/nick":return this.replaceCommandNick(t);case"/error":return this.replaceCommandError(t);default:return this.replaceCustomCommands(e,t)}}catch(s){}return e},replaceCommandLogin:function(e){return'<span class="chatBotMessage">'+this.lang.login.replace(/%s/,e[1])+"</span>"},replaceCommandLogout:function(e){var t="";return 3===e.length&&(t=e[2]),'<span class="chatBotMessage">'+this.lang["logout"+t].replace(/%s/,e[1])+"</span>"},replaceCommandChannelEnter:function(e){return'<span class="chatBotMessage">'+this.lang.channelEnter.replace(/%s/,e[1])+"</span>"},replaceCommandChannelLeave:function(e){return'<span class="chatBotMessage">'+this.lang.channelLeave.replace(/%s/,e[1])+"</span>"},replaceCommandPrivMsg:function(e){var t=e.slice(1).join(" ");return t=this.replaceBBCode(t),t=this.replaceHyperLinks(t),t=this.replaceEmoticons(t),'<span class="privmsg">'+this.lang.privmsg+"</span> "+t},replaceCommandPrivMsgTo:function(e){var t=e.slice(2).join(" ");return t=this.replaceBBCode(t),t=this.replaceHyperLinks(t),t=this.replaceEmoticons(t),'<span class="privmsg">'+this.lang.privmsgto.replace(/%s/,e[1])+"</span> "+t},replaceCommandPrivAction:function(e){var t=e.slice(1).join(" ");return t=this.replaceBBCode(t),t=this.replaceHyperLinks(t),t=this.replaceEmoticons(t),'<span class="action">'+t+'</span> <span class="privmsg">'+this.lang.privmsg+"</span> "},replaceCommandPrivActionTo:function(e){var t=e.slice(2).join(" ");return t=this.replaceBBCode(t),t=this.replaceHyperLinks(t),t=this.replaceEmoticons(t),'<span class="action">'+t+'</span> <span class="privmsg">'+this.lang.privmsgto.replace(/%s/,e[1])+"</span> "},replaceCommandAction:function(e){var t=e.slice(1).join(" ");return t=this.replaceBBCode(t),t=this.replaceHyperLinks(t),t=this.replaceEmoticons(t),'<span class="action">'+t+"</span>"},replaceCommandInvite:function(e){var t=this.lang.invite.replace(/%s/,e[1]).replace(/%s/,"<a href=\"javascript:ajaxChat.sendMessageWrapper('/join "+this.scriptLinkEncode(e[2])+'\');" title="'+this.lang.joinChannel.replace(/%s/,e[2])+'">'+e[2]+"</a>");return'<span class="chatBotMessage">'+t+"</span>"},replaceCommandInviteTo:function(e){var t=this.lang.inviteto.replace(/%s/,e[1]).replace(/%s/,e[2]);return'<span class="chatBotMessage">'+t+"</span>"},replaceCommandUninvite:function(e){var t=this.lang.uninvite.replace(/%s/,e[1]).replace(/%s/,e[2]);return'<span class="chatBotMessage">'+t+"</span>"},replaceCommandUninviteTo:function(e){var t=this.lang.uninviteto.replace(/%s/,e[1]).replace(/%s/,e[2]);return'<span class="chatBotMessage">'+t+"</span>"},replaceCommandQueryOpen:function(e){return'<span class="chatBotMessage">'+this.lang.queryOpen.replace(/%s/,e[1])+"</span>"},replaceCommandQueryClose:function(e){return'<span class="chatBotMessage">'+this.lang.queryClose.replace(/%s/,e[1])+"</span>"},replaceCommandIgnoreAdded:function(e){return'<span class="chatBotMessage">'+this.lang.ignoreAdded.replace(/%s/,e[1])+"</span>"},replaceCommandIgnoreRemoved:function(e){return'<span class="chatBotMessage">'+this.lang.ignoreRemoved.replace(/%s/,e[1])+"</span>"},replaceCommandIgnoreList:function(e){return'<span class="chatBotMessage">'+this.lang.ignoreList+" "+this.getInlineUserMenu(e.slice(1))+"</span>"},replaceCommandIgnoreListEmpty:function(){return'<span class="chatBotMessage">'+this.lang.ignoreListEmpty+"</span>"},replaceCommandKick:function(e){return'<span class="chatBotMessage">'+this.lang.logoutKicked.replace(/%s/,e[1])+"</span>"},replaceCommandWho:function(e){return'<span class="chatBotMessage">'+this.lang.who+" "+this.getInlineUserMenu(e.slice(1))+"</span>"},replaceCommandWhoChannel:function(e){return'<span class="chatBotMessage">'+this.lang.whoChannel.replace(/%s/,e[1])+" "+this.getInlineUserMenu(e.slice(2))+"</span>"},replaceCommandWhoEmpty:function(){return'<span class="chatBotMessage">'+this.lang.whoEmpty+"</span>"},replaceCommandList:function(e){for(var i,t=e.slice(1),s=[],n=0;n<t.length;n++)i=t[n]===this.channelName?"<b>"+t[n]+"</b>":t[n],s.push("<a href=\"javascript:ajaxChat.sendMessageWrapper('/join "+this.scriptLinkEncode(t[n])+'\');" title="'+this.lang.joinChannel.replace(/%s/,t[n])+'">'+i+"</a>");return'<span class="chatBotMessage">'+this.lang.list+" "+s.join(", ")+"</span>"},replaceCommandBans:function(e){for(var t=e.slice(1),s=[],i=0;i<t.length;i++)s.push("<a href=\"javascript:ajaxChat.sendMessageWrapper('/unban "+this.scriptLinkEncode(t[i])+'\');" title="'+this.lang.unbanUser.replace(/%s/,t[i])+'">'+t[i]+"</a>");return'<span class="chatBotMessage">'+this.lang.bans+" "+s.join(", ")+"</span>"},replaceCommandBansEmpty:function(){return'<span class="chatBotMessage">'+this.lang.bansEmpty+"</span>"},replaceCommandUnban:function(e){return'<span class="chatBotMessage">'+this.lang.unban.replace(/%s/,e[1])+"</span>"},replaceCommandWhois:function(e){return'<span class="chatBotMessage">'+this.lang.whois.replace(/%s/,e[1])+" "+e[2]+"</span>"},replaceCommandWhereis:function(e){return'<span class="chatBotMessage">'+this.lang.whereis.replace(/%s/,e[1]).replace(/%s/,"<a href=\"javascript:ajaxChat.sendMessageWrapper('/join "+this.scriptLinkEncode(e[2])+'\');" title="'+this.lang.joinChannel.replace(/%s/,e[2])+'">'+e[2]+"</a>")+"</span>"},replaceCommandRoll:function(e){var t=this.lang.roll.replace(/%s/,e[1]);return t=t.replace(/%s/,e[2]),t=t.replace(/%s/,e[3]),'<span class="chatBotMessage">'+t+"</span>"},replaceCommandNick:function(e){return'<span class="chatBotMessage">'+this.lang.nick.replace(/%s/,e[1]).replace(/%s/,e[2])+"</span>"},replaceCommandError:function(e){var t=this.lang["error"+e[1]];return t?e.length>2&&(t=t.replace(/%s/,e.slice(2).join(" "))):t="Error: Unknown.",'<span class="chatBotErrorMessage">'+t+"</span>"},getInlineUserMenu:function(e){for(var t="",s=0;s<e.length;s++)s>0&&(t+=", "),t+="<a href=\"javascript:ajaxChat.toggleUserMenu('"+this.getInlineUserMenuDocumentID(this.userMenuCounter,s)+"', '"+this.scriptLinkEncode(e[s])+'\', null);" title="'+this.lang.toggleUserMenu.replace(/%s/,e[s])+'" dir="'+this.baseDirection+'">'+(e[s]===this.userName?"<b>"+e[s]+"</b>":e[s])+'</a><ul class="inlineUserMenu" id="'+this.getInlineUserMenuDocumentID(this.userMenuCounter,s)+'" style="display:none;"></ul>';return this.userMenuCounter++,t},containsUnclosedTags:function(e){var t,s,i=/<[^>\/]+?>/gm,n=/<\/[^>]+?>/gm;return t=e.match(i),s=e.match(n),!t&&s||t&&!s||t&&s&&t.length!==s.length?!0:!1},breakLongWords:function(e){var t,s,i,n,a,r;if(!this.settings.wordWrap)return e;for(t="",s=0,r=0;r<e.length;r++)i=e.charAt(r),"<"===i?(n=!0,r>5&&"<br/"===e.substr(r-5,4)&&(s=0)):n&&r>0&&">"===e.charAt(r-1)&&(n=!1,r>4&&"<br/"===e.substr(r-5,4)&&(s=0)),n||"&"!==i?a&&r>0&&";"===e.charAt(r-1)&&(a=!1,s++):a=!0,n||a||(" "===i||"\n"===i||"	"===i?s=0:s++,s>this.settings.maxWordLength&&(t+="&#8203;",s=0)),t+=i;return t},replaceBBCode:function(e){return this.settings.bbCode?e.replace(/\[(\w+)(?:=([^<>]*?))?\](.+?)\[\/\1\]/gm,this.replaceBBCodeCallback):e.replace(/\[(?:\/)?(\w+)(?:=([^<>]*?))?\]/,"")},replaceBBCodeCallback:function(e,t,s,i){if(!ajaxChat.inArray(ajaxChat.bbCodeTags,t))return e;if(ajaxChat.containsUnclosedTags(i))return e;switch(t){case"color":return ajaxChat.replaceBBCodeColor(i,s);case"url":return ajaxChat.replaceBBCodeUrl(i,s);case"img":return ajaxChat.replaceBBCodeImage(i);case"quote":return ajaxChat.replaceBBCodeQuote(i,s);case"code":return ajaxChat.replaceBBCodeCode(i);case"u":return ajaxChat.replaceBBCodeUnderline(i);default:return ajaxChat.replaceCustomBBCode(t,s,i)}},replaceBBCodeColor:function(e,t){return this.settings.bbCodeColors&&t&&this.inArray(ajaxChat.colorCodes,t)?'<span style="color:'+t+';">'+this.replaceBBCode(e)+"</span>":e},replaceBBCodeUrl:function(e,t){var s,i;return s=t?t.replace(/\s/gm,this.encodeText(" ")):this.stripBBCodeTags(e.replace(/\s/gm,this.encodeText(" "))),i=new RegExp("^(?:(?:http)|(?:https)|(?:ftp)|(?:irc)):\\/\\/",""),s&&s.match(i)?'<a href="'+s+'" onclick="window.open(this.href); return false;">'+this.replaceBBCode(e)+"</a>":e},replaceBBCodeImage:function(e){var t,s,i;return this.settings.bbCodeImages?(t=new RegExp(this.regExpMediaUrl,""),e&&e.match(t)?(e=e.replace(/\s/gm,this.encodeText(" ")),s=this.dom.chatList.offsetWidth-50,i=this.dom.chatList.offsetHeight-50,'<a href="'+e+'" onclick="window.open(this.href); return false;"><img class="bbCodeImage" style="max-width:'+s+"px; max-height:"+i+'px;" src="'+e+'" alt="" onload="ajaxChat.updateChatlistView();"/></a>'):e):e},replaceBBCodeQuote:function(e,t){return t?'<span class="quote"><cite>'+this.lang.cite.replace(/%s/,t)+"</cite><q>"+this.replaceBBCode(e)+"</q></span>":'<span class="quote"><q>'+this.replaceBBCode(e)+"</q></span>"},replaceBBCodeCode:function(e){return"<code>"+this.replaceBBCode(e.replace(/\t|(?:  )/gm,"&#160;&#160;"))+"</code>"},replaceBBCodeUnderline:function(e){return'<span style="text-decoration:underline;">'+this.replaceBBCode(e)+"</span>"},replaceHyperLinks:function(e){var t;return this.settings.hyperLinks?(t=new RegExp("(^|\\s|>)((?:(?:http)|(?:https)|(?:ftp)|(?:irc)):\\/\\/[^\\s<>]+)(<\\/a>)?","gm"),e.replace(t,function(e,t,s,i){return i?e:t+'<a href="'+s+'" onclick="window.open(this.href); return false;">'+s+"</a>"})):e},replaceLineBreaks:function(e){var t=new RegExp("\\n","g");return this.settings.lineBreaks?e.replace(t,"<br/>"):e.replace(t," ")},replaceEmoticons:function(e){if(!this.settings.emoticons)return e;if(!arguments.callee.regExp){for(var t="^(.*)(",s=0;s<this.emoticonCodes.length;s++)0!==s&&(t+="|"),t+="(?:"+this.escapeRegExp(this.emoticonCodes[s])+")";t+=")(.*)$",arguments.callee.regExp=new RegExp(t,"gm")}return e.replace(arguments.callee.regExp,this.replaceEmoticonsCallback)},replaceEmoticonsCallback:function(e,t,s,i){if(arguments.callee.regExp||(arguments.callee.regExp=new RegExp('(="[^"]*$)|(&[^;]*$)',"")),t.match(arguments.callee.regExp))return e;if(s){var n=ajaxChat.arraySearch(s,ajaxChat.emoticonCodes);return ajaxChat.replaceEmoticons(t)+'<img src="'+ajaxChat.dirs.emoticons+ajaxChat.emoticonFiles[n]+'" alt="'+s+'" />'+ajaxChat.replaceEmoticons(i)}return e},getActiveStyle:function(){var e=this.readCookie(this.sessionName+"_style"),t=e?e:this.getPreferredStyleSheet();return t},initStyle:function(){this.styleInitiated=!0,this.setActiveStyleSheet(this.getActiveStyle())},persistStyle:function(){this.styleInitiated&&this.createCookie(this.sessionName+"_style",this.getActiveStyleSheet(),this.cookieExpiration)},setSelectedStyle:function(){if(this.dom.styleSelection)for(var e=this.getActiveStyle(),t=this.dom.styleSelection.getElementsByTagName("option"),s=0;s<t.length;s++)if(t[s].value==e){t[s].selected=!0;break}},getSelectedStyle:function(){var e=this.dom.styleSelection.getElementsByTagName("option");return-1===this.dom.styleSelection.selectedIndex?e[0].value:e[this.dom.styleSelection.selectedIndex].value},setActiveStyleSheet:function(e){var t,s,n=!1;for(t=0;s=document.getElementsByTagName("link")[t];t++)-1!==s.getAttribute("rel").indexOf("style")&&s.getAttribute("title")&&(s.disabled=!0,s.getAttribute("title")===e&&(s.disabled=!1,n=!0));n||null===e||this.setActiveStyleSheet(this.getPreferredStyleSheet())},getActiveStyleSheet:function(){var e,t;for(e=0;t=document.getElementsByTagName("link")[e];e++)if(-1!=t.getAttribute("rel").indexOf("style")&&t.getAttribute("title")&&!t.disabled)return t.getAttribute("title");return null},getPreferredStyleSheet:function(){var e,t;for(e=0;t=document.getElementsByTagName("link")[e];e++)if(-1!==t.getAttribute("rel").indexOf("style")&&-1===t.getAttribute("rel").indexOf("alt")&&t.getAttribute("title"))return t.getAttribute("title");return null},switchLanguage:function(e){window.location.search="?lang="+e},createCookie:function(e,t,s){var i="";if(s){var n=new Date;n.setTime(n.getTime()+24*s*60*60*1e3),i="; expires="+n.toGMTString()}var a="; path="+this.cookiePath,r=this.cookieDomain?"; domain="+this.cookieDomain:"",o=this.cookieSecure?"; secure":"";document.cookie=e+"="+encodeURIComponent(t)+i+a+r+o},readCookie:function(e){if(!document.cookie)return null;for(var t=e+"=",s=document.cookie.split(";"),i=0;i<s.length;i++){for(var n=s[i];" "===n.charAt(0);)n=n.substring(1,n.length);if(0===n.indexOf(t))return decodeURIComponent(n.substring(t.length,n.length))}return null},isCookieEnabled:function(){this.createCookie(this.sessionName+"_cookie_test",!0,1);var e=this.readCookie(this.sessionName+"_cookie_test");return e?(this.createCookie(this.sessionName+"_cookie_test",!0,-1),!0):!1},finalize:function(){if("function"==typeof this.finalizeFunction&&this.finalizeFunction(),this.socket)try{this.socket.close(),this.socket=null}catch(e){}this.persistSettings(),this.persistStyle(),this.customFinalize()},initializeCustomFlashInterface:function(){},handleCustomInfoMessage:function(){},customInitialize:function(){},customFinalize:function(){},getCustomUserMenuItems:function(){return""},parseCustomInputMessage:function(e){return e},parseCustomInputCommand:function(e){return e},replaceCustomText:function(e){return e},replaceCustomCommands:function(e){return e},replaceCustomBBCode:function(e,t,s){return"<"+e+">"+this.replaceBBCode(s)+"</"+e+">"},customOnNewMessage:function(){return!0}};